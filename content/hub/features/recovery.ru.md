---
title: "Восстановление файлов"
type: docs
---
Lumi поддерживает две независимые системы восстановления — автоматическое фоновое сохранение и инкрементные контрольные точки вручную — обе доступны из одного диалогового окна.

## Доступ

**Файл** → **Восстановить изображение**

Откроется диалоговое окно с предварительно заполненными состояниями восстановления для текущего открытого файла. Используйте средство выбора файлов вверху, чтобы переключиться на другой файл `.lum`.

---

## Автосохранение

Lumi сохраняет фоновый снимок вашей работы через определенные промежутки времени во время редактирования. Автосохранения записываются в **отдельный каталог кэша**, оставляя рабочий файл `.lum` нетронутым:

```
~/.cache/lumi/autosave/~home~user~projects~my-painting.lum/
```

Кодировка пути использует `~` в качестве разделителя для создания уникального каталога кэша для каждого файла. Это означает, что автосохранение доступно, даже если сам файл проекта утерян или поврежден.

- **Частота**: настраивается в меню **Редактирование** → **Настройки** → **Производительность** → Интервал автосохранения.
- **Место хранения**: также устанавливается в «Настройки» → «Производительность».
- **Цель**: восстановление после сбоя. На вкладке «Автосохранение» диалогового окна «Восстановить изображение» отображаются доступные состояния автосохранения с метками времени.

Когда вы открываете файл с новыми данными автосохранения, Lumi уведомляет вас во время открытия.

---

## Дополнительные сохранения

Инкрементное сохранение — это ручная система контрольных точек, которая хранится **внутри файла проекта** в папке `recovery/`. Структура:

```
my-painting.lum/recovery/
  └── primary-01.lum/       (full baseline, created on first Ctrl+S)
      ├── delta-0001.lum/   (Ctrl+S checkpoint, only modified buffers)
      ├── delta-0002.lum/
      └── ...
```

Новая базовая линия `primary-NN.lum/` записывается после **Файл → Сохранить**. Последующие нажатия Ctrl+S создают подкаталоги `delta-NNNN.lum/`, содержащие только те буферы, которые изменились с момента последней базовой версии. Дельты автосохранения и дельты сохранения вручную используют отдельные счетчики, поэтому они не мешают истории друг друга.

Инкрементное сохранение **отключено по умолчанию** и должно быть включено для каждого проекта:

1. **Файл** → **Сохранить как** (Shift+Ctrl+S).
2. В диалоговом окне «Сохранить как» установите флажок **Дополнительное сохранение** и при необходимости установите ограничение **Максимальное количество сохранений**.
3. Настройка сохраняется вместе с проектом и применяется ко всем последующим нажатиям Ctrl+S.

Когда вы открываете файл `.lum`, который имеет более новые инкрементные сохранения, чем основное сохранение, Lumi отображает сообщение **Обнаружено добавочное сохранение**, предлагающее загрузить самую последнюю контрольную точку.

---

## Диалоговое окно восстановления изображения

Диалоговое окно имеет три вкладки и две кнопки действий.

### Вкладка автосохранения

Перечисляет все доступные состояния автосохранения для выбранного файла с метками времени и миниатюрами (если таковые имеются). Выберите состояние и нажмите **Восстановить**, чтобы открыть его.

Используйте эту вкладку, чтобы:
- Восстановление после сбоя.
- Вернуться к более раннему состоянию из того же сеанса.

### Вкладка «Добавка»

Перечисляет все состояния контрольных точек, хранящиеся в файле проекта. Каждая запись показывает временную метку контрольной точки. Выберите контрольную точку и нажмите **Восстановить**, чтобы открыть ее.

Используйте эту вкладку, чтобы:
- Вернуться к более раннему моменту сеанса без сохранения отдельных файлов.
- Просмотрите историю версий проекта.

### Последняя вкладка

Вкладка по умолчанию при открытии диалогового окна. Автоматически определяет новейшее доступное состояние восстановления как в автосохранении, так и в дополнительных контрольных точках, а также показывает его временную метку. Нажмите **Восстановить**, чтобы загрузить его немедленно, не просматривая отдельные состояния.

---

## Кнопки

| Кнопка | Действие |
|--------|--------|
| **Восстановить** | Открывает выбранное состояние восстановления как новый образ. |
| **Закрыть** | Закрывает диалог без восстановления. |
| **Очистка старых штатов…** | Открывает окно очистки (см. ниже). |

---

## Очистка старых состоянийНакопление состояний восстановления с течением времени может занять значительный объем дискового пространства. Кнопка **Очистить старые состояния…** (в левом нижнем углу диалогового окна) открывает запрос на очистку активной вкладки (автосохранение или добавочная).

В подсказке показано:
- Сколько полных сохранений существует для файла.
- Общий объем занимаемого ими дискового пространства.
- Прокручивающаяся кнопка **Сохранить самые последние**, позволяющая выбрать, сколько сохранений следует сохранить.

Установка для параметра **Сохранить самые последние** значения `0` удаляются все состояния восстановления. Следующее нажатие Ctrl+S после полной очистки запишет новое первичное сохранение.

---

## Восстановление при запуске

Если при запуске Lumi обнаруживает, что последний открытый файл содержит более новые данные автосохранения, чем последнее полное сохранение, перед загрузкой он отображает запрос на восстановление. Вы можете принять (загрузить автосохранение) или отклонить (открыть основное сохранение как обычно).