---
title: "レイヤーと非破壊編集"
type: docs
---
Lumi のレイヤー システムにより、ブレンディング、マスキング、合成を完全に制御できる、複雑で非破壊的なワークフローが可能になります。

## 概要

レイヤーは構造化されたイラストの基礎です。各レイヤーは独立しており、独自の描画モード、不透明度、およびオプションのレイヤー マスクを備えています。グループは、独自のブレンディングおよびクリッピング プロパティを使用してレイヤーを階層的にネストできます。

## アクセス

**パネル** → **レイヤー**、または右側のデフォルトの**レイヤー** パネル。

## レイヤーの種類

### ペイント レイヤ
ペイントされたコンテンツの標準ラスター レイヤー。オプションのアルファ透明度を使用して、ピクセル データを GEGL バッファーとして保存します。

### グループレイヤー
関連するレイヤーを整理するための階層コンテナー。グループは独自の描画モード、不透明度、クリッピング マスクを持つことができます。グループ投影はオンデマンドで合成されます。

### レイヤーマスク
グレースケール マスクは任意のレイヤーにアタッチされ、ピクセルごとの不透明度を制御します。マスクに白をペイントすると、ピクセルが不透明になります。黒はそれらを透明にします。グレーは部分的に不透明になります。

## ブレンドモード

すべてのレイヤーには、以下のレイヤーとどのように組み合わせるかを決定するブレンド モードがあります。

- **通常**: 不透明度を直接ブレンドします。
- **乗算**: カラー値を乗算して暗くします。
- **画面**: 反転、乗算、再度反転することで明るくなります。
- **オーバーレイ**: 乗算とスクリーンの組み合わせ。
- **加算**: 加算ブレンド (カラー値を合計)。
- **減算**: 減算ブレンド。
- **色、色相、彩度、明度**: HSL コンポーネントのブレンド。

## クリッピングとマスキング

- **合成モード — 背景にクリップ**: レイヤーの合成モードを **背景にクリップ** に設定すると、下の累積された **ユニオン** レイヤーが不透明度を確立している領域に合成が制限されます。レイヤーは、レイヤーにコンテンツがある場所のみをペイントします。アルファ フットプリントを拡張することはできません。これは、[レイヤー属性] ダイアログ (**複合モード** ドロップダウン) でレイヤーごとに設定されます。レイヤーの有効な合成モードがユニオン以外の場合、レイヤーパネルの目のアイコンが合成アイコンに置き換えられ、非標準の合成動作が示されます。

  **例 — 共有アルファ シェイプ:** グループ内の最下位レイヤーには、デフォルトの **ユニオン** 複合モードに設定された、透明な背景上の塗りつぶされた円が含まれています。同じグループ内のその上のすべてのレイヤーは **背景にクリップ** に設定されます。これらのレイヤーは、円が不透明を提供する場所 (1 つの形状、多数のレイヤー) のみをペイントできます。これは、こぼれを心配することなく、定義されたシルエット内でカラーリング、シェーディング、ディテールを施すための一般的なパターンです。
- **レイヤー マスク**: グレースケール マスクを適用して、レイヤーの可視性をピクセルごとに制御します。マスクに白を塗ると明らかになります。黒は隠します。グレーは部分的に不透明になります。
- **純粋な子マスク**: マスクは描画可能スタック内に子として保存され、変換中のデータ損失を防ぎます。

## レイヤー選択 (Alt キー)

キャンバス上にカーソルを置きながら **Alt** (左 Alt) をタップすると、ツールを切り替えたりクリックしたりせずに、カーソルの下にピクセルが表示されているレイヤーが選択されます。

### 仕組み

- **Alt を押す**: カーソルが十字に変わり、ピッキング モードがアクティブであることを示します。
- **Alt を離す**: Lumi はカーソル位置 (不透明度 > 25%) で最上部の不透明レイヤーを選択し、それを選択します。 [レイヤー] パネルでレイヤーが強調表示され、ステータス バーに **「選択されたレイヤー: 'レイヤー名'」** と表示されます。
- キャンバス上の選択したレイヤーの中心点にハンドルが描画されます。カーソルが遠ざかるにつれて、ハンドルは小さくなり、色が消えます。

### レイヤー間の循環同じ位置で後続の Alt タップを行うたびに、その時点のスタック内の**次の下のレイヤー**が選択されます。 Lumi は最後に選択したレイヤーを覚えており、そのレイヤーを通過してその下のレイヤーにスキップします。スタックの最下位に到達すると、次のタップはその位置の最上層に戻ります。これにより、Alt を繰り返しタップするだけで、複雑なシーンのネストされたレイヤーに簡単にアクセスできるようになります。

### キャンセルルール

Alt を押したまま次のいずれかが発生した場合、ピックはキャンセルされます (Alt を放しても起動しません)。

- マウス ボタンが押されました (左または右クリック)。
- 他のキーが押された。

これにより、アクティブなレイヤーを誤って変更することなく、Alt ドラッグ ジェスチャ (ブラシ サイズ調整など) と Alt で変更されたショートカットが機能するようになります。

### 制限事項

- **変換** ツールの操作中にレイヤーの選択はアクティブになりません。そこでは Alt が別の意味を持ちます。
- フローティング選択が存在する場合、ピッキングは行われません。
- 左 Alt のみがピッキングをトリガーします。右 Alt は標準の修飾子として扱われます。

## 操作

[レイヤー]パネルで:

- **レイヤーの作成**: 右クリック → **新しいレイヤー**、または **レイヤー** メニューを使用します。
- **複製**: 右クリック→**複製**、または**レイヤー**→**複製**。
- **削除**: 右クリック→**削除**、または選択して**削除**を押します。
- **並べ替え**: レイヤーを上下にドラッグして、重なり順を変更します。
- **名前の変更**: レイヤー名をダブルクリックします。
- **下に結合**: 右クリック→**下に結合**して、下のレイヤーと結合します。
- **画像を平坦化**: **画像** → **画像を平坦化**して、表示されているすべてのレイヤーを結合します。

## レイヤーのプロパティ

- **不透明度**: 0 ～ 100%、レイヤー全体の透明度を制御します。
- **ブレンディング モード**: レイヤーを下のレイヤーと結合する方法を選択するドロップダウン メニュー。
- **表示/非表示**: 目のアイコンでレイヤーの表示/非表示を切り替えます。

## レイヤーロック

ロックアイコンはレイヤーパネルのヘッダー行に表示されます。各ロックは個別に切り替えることができます。鍵アイコンを右クリックすると、そのアイコンが排他的に設定されます (そのタイプのみがロックされ、同じレイヤー上の他のすべてのロックが解除されます)。

- **アルファをロック**: 透明な領域へのペイントを防ぎます。ブラシ ストロークは、すでに不透明度を持つピクセルにのみ影響します。完全に透明なピクセルは変更されません。既存のシェイプの外側にこぼれることなく、そのシェイプ内にペイントする場合に便利です。

- **マスクをロック**: レイヤーマスクの編集を禁止します。マスクは表示されアクティブなままですが、このロックがオンになっている間はペイントしたり変更したりすることはできません。

- **カラーをロック**: ペイントを特定の色 (ロックが適用された時点での現在の前景色) にロックします。このレイヤー上の後続のストロークでは、アクティブな前景色に関係なく、その保存されたカラーが使用されます。ロックを解除すると、保存されている色が破棄されます。

- **コンテンツをロック** (ピクセルをロック): レイヤーに対するすべてのピクセル編集を禁止します。レイヤーはペイント、塗りつぶし、変形、その他の変更を行うことができません。完成したレイヤーを保護するのに役立ちます。

- **位置をロック**: レイヤーの移動や変形を防ぎます。レイヤーは引き続き編集できます。位置の変更 (移動ツール、変形ツール) のみがブロックされます。

- **可視性をロック**: 目のアイコンによってレイヤーの可視性が切り替わらないようにします。編集中に常に表示 (または非表示) にしておく必要があるレイヤーを保護します。

すべてのロックはプロジェクトとともに保存され、セッションをまたいで保持されます。

## レイヤーエフェクト (FX)

**フィルター** メニューを通じて適用された非破壊 GEGL フィルターは、ピクセルをすぐに変更するのではなく、レイヤー上にコミットされたエフェクトとして保存されます。レイヤーに少なくとも 1 つのコミットされたエフェクトがある場合、そのレイヤーの隣の [レイヤー] パネルに **fx** アイコンが表示されます。### エフェクトポップアップへのアクセス

[レイヤー]パネルのレイヤー行にある**fx**アイコンをクリックして、そのレイヤーの**レイヤーエフェクト**ポップオーバーを開きます。

ポップオーバーにはレイヤーのフィルター スタックが表示されます。コミットされた各エフェクトは名前ごとにリストされ、その横に表示/非表示の切り替えが表示されます。

### コントロール

- **目の可視性切り替え** (ポップアップの上部): すべてのエフェクトのオンとオフを同時に切り替えます。
- **フィルターごとの表示切り替え**: 各フィルター行には、その効果を個別に有効または無効にするための独自の目のアイコンがあります。
- **編集**: 選択したフィルターの設定ダイアログを開き、パラメーターを非破壊的に調整できるようにします。
- **上げる/下げる**: 選択したフィルターをスタック内で上下に移動し、エフェクトが適用される順序を変更します。
- **マージ**: 現在表示されているすべての効果をレイヤーのピクセルにコミットし、変更を永続的にします。すべてのエフェクトがマージされると、fx アイコンは削除されます。結合はグループ レイヤーでは使用できません。
- **削除**: 選択したフィルターを完全に削除します。エフェクトが残っていない場合、ポップオーバーは自動的に閉じます。

リスト内のフィルターをダブルクリックしても、その編集ダイアログが開きます。

レイヤーでピクセルのロックが有効になっている場合、**編集**と**削除**はブロックされます。フィルタがアクティブに編集されている間は、フィルタの順序を変更することはできません。

### エフェクトの追加

**フィルター** → (任意のカテゴリ) からフィルターを適用します。アクティブなレイヤーがターゲットであり、操作が非破壊的に実行される場合、結果はピクセル データにベイクされるのではなく、レイヤー エフェクトとして保存されます。少なくとも 1 つのエフェクトが存在する場合、レイヤーに fx アイコンが表示されます。

## 「レイヤー属性」ダイアログ

[レイヤー]パネルでレイヤーをダブルクリックして、[レイヤー属性]ダイアログを開きます。

### アイデンティティ

- **カラータグ**: レイヤーパネルで視覚的に整理するためのカラーラベル。

### 複合空間とモード

- **合成空間**: このレイヤーを下のレイヤーと合成するときに使用される色空間。オプション: 自動、リニア (RGB)、知覚的 (RGB)。
- **複合モード**: レイヤーのアルファが背景とどのように相互作用するかを制御します。オプションには、[結合] (すべての領域に影響します。通常モードのデフォルト)、[背景にクリップ] (既存のコンテンツのある領域のみに影響します。他のほとんどのブレンド モードのデフォルト)、および [交差] があります。

### サイズとオフセット

既存のレイヤーの場合、**サイズ** にはレイヤーの寸法とマスクの寸法 (マスクがアタッチされている場合) が読み取り専用のラベルとして表示されます。

**レイヤー オフセット** — キャンバス上のレイヤーの位置を制御する X および Y スピナー。変更はダイアログを閉じるときではなく、すぐに適用されます。

レイヤーにマスクがある場合、**マスク オフセット** (マスクの独立した位置の X および Y スピナー) が以下に表示されます。

新しいレイヤーを作成すると、幅と高さのフィールドと **塗りつぶし** ドロップダウン (前景、背景、白、透明) が読み取り専用のサイズ表示に置き換わります。

### レイヤー属性 (永続的な寄生虫)

ダイアログの下部セクションには、永続パラサイト (レイヤーに添付された任意のキーと値のメタデータ) のスクロール可能な名前/値テーブルが含まれています。これらの値はプロジェクトとともに保存され、Scheme スクリプト インターフェイスからアクセスできます。

- [名前] 列または [値] 列の任意のセルをクリックして、インラインで編集します。
- **追加**: 新しい空の行を追加します。
- **削除**: 選択した行とその寄生要素をレイヤーから削除します。

レイヤーに永続的な寄生虫がない場合は、3 つの空のスターター行が表示されます。

### コンテンツの状態下部の読み取り専用情報行には、レイヤー (および存在する場合はマスク) の現在のコンテンツ状態 (**クリア**、**均一**、**混合**) が表示されます。 `*` プレフィックスは、最後の保存以降、レイヤーに未保存の変更があることを示します。

## パフォーマンス

- **高速モード**: グループ内にネストされた単一レイヤーにペイントする場合、Lumi はストロークの間、祖先グループを一時的にパススルー レンダリングに切り替え、完全なグループ投影の再構成をスキップします。これにより、インク付けおよびペイント中のネストされた投影の更新遅延が解消されます。ストロークが終了するとき、アクティブなレイヤーが変更されるとき、または保存する前に、完全な合成が再開されます。

  次の条件のいずれかが祖先グループに当てはまる場合、高速モードは無効になります。
  - グループには可視の非破壊フィルターがあります (フィルターには投影バッファーが必要です)。
  - グループのブレンド モードが **ノーマル** または **パススルー** 以外である。
  - グループには、**背景にクリップ** または **交差** 複合モードを使用する直接の子があります (これらには、投影バッファーからの背景データが必要です)。

  また、高速モードは、最上位レイヤー、フローティング選択範囲、または複数のレイヤーが同時にターゲットになっている場合にはアクティブになりません。

  ペイント グループでこれらの状況を回避するようにファイルを構造化し、レイヤーでノーマル ブレンド モードを使用すると、インクまたはペイント セッション全体にわたって高速モードがアクティブなままになります。
- **遅延読み込み**: 大規模なプロジェクトはすぐに読み込まれます。レイヤー データは、必要な場合にのみロードされます (例: 表示またはペイントされた場合)。

## ファイル形式

すべてのレイヤー、マスク、プロパティは、Lumi のオープンな `.lum` 形式で保存されます。このファイルは、個々のレイヤー バッファーとメタデータを含むディレクトリであり、互換性と長期的なアクセス性を保証します。