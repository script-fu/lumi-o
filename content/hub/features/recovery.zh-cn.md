---
title: "文件恢复"
type: docs
---
Lumi 维护两个独立的恢复系统（自动后台保存和手动增量检查点），均可通过单个对话框进行访问。

## 访问

**文件** → **恢复图像**

该对话框将打开，其中预先填充了当前打开文件的恢复状态。使用顶部的文件选择器切换到不同的 `.lum` 文件。

---

## 自动保存

Lumi 在编辑时定期保存您作品的背景快照。自动保存被写入 **单独的缓存目录**，使工作 `.lum` 文件保持不变：

```
~/.cache/lumi/autosave/~home~user~projects~my-painting.lum/
```

路径编码使用 `~` 作为分隔符来为每个文件创建唯一的缓存目录。这意味着即使项目文件本身丢失或损坏，自动保存也可用。

- **频率**：可在 **编辑** → **首选项** → **性能** → 自动保存间隔中配置。
- **存储位置**：也在首选项 → 性能中设置。
- **目的**：崩溃恢复。 “恢复图像”对话框中的“自动保存”选项卡显示可用的自动保存状态和时间戳。

当您打开包含较新自动保存数据的文件时，Lumi 会在打开时通知您。

---

## 增量保存

增量保存是一个手动检查点系统，存储在`recovery/`下**项目文件**内。结构是：

```
my-painting.lum/recovery/
  └── primary-01.lum/       (full baseline, created on first Ctrl+S)
      ├── delta-0001.lum/   (Ctrl+S checkpoint, only modified buffers)
      ├── delta-0002.lum/
      └── ...
```

在**文件→保存**之后写入新的`primary-NN.lum/`基线。随后按 Ctrl+S 将创建 `delta-NNNN.lum/` 子目录，其中仅包含自上次基线以来更改的缓冲区。自动保存增量和手动保存增量使用单独的计数器，因此它们不会干扰彼此的历史记录。

增量保存**默认禁用**，并且必须针对每个项目启用：

1. **文件** → **另存为** (Shift+Ctrl+S)。
2. 在“另存为”对话框中，选中 **增量保存** 并可选择设置 **最大保存** 限制。
3. 该设置与项目一起存储，并应用于所有后续的 Ctrl+S 按下。

当您打开具有比主保存更新的增量保存的`.lum` 文件时，Lumi 会显示“检测到增量保存”提示，提供加载最新检查点的提示。

---

## 恢复图像对话框

该对话框具有三个选项卡和两个操作按钮。

### 自动保存选项卡

列出所选文件的所有可用自动保存状态，以及时间戳和缩略图（如果可用）。选择一个状态并单击“**恢复**”将其打开。

使用此选项卡可以：
- 崩溃后恢复。
- 从同一会话恢复到较早的状态。

### 增量选项卡

列出项目文件中存储的所有检查点状态。每个条目都显示检查点时间戳。选择一个检查点并单击“**恢复**”将其打开。

使用此选项卡可以：
- 返回到会话中的较早点，而无需保存单独的文件。
- 浏览项目的版本历史记录。

### 最新标签

对话框打开时的默认选项卡。自动识别自动保存和增量检查点的最新可用恢复状态，并显示其时间戳。单击“**恢复**”即可立即加载它，而无需浏览各个状态。

---

## 按钮

|按钮|行动|
|--------|--------|
| **恢复** |将选定的恢复状态打开为新映像。 |
| **关闭** |关闭对话框而不恢复。 |
| **清理旧州......** |打开清理提示（见下文）。 |

---

## 清理旧状态随着时间的推移累积恢复状态可能会消耗大量磁盘空间。 **清理旧状态...**按钮（对话框左下角）打开活动选项卡（自动保存或增量）的清理提示。

提示显示：
- 文件存在多少个完整保存。
- 它们占用的总磁盘空间。
- **保留最近的**旋转按钮，用于选择要保留的保存数量。

将**保留最新**设置为 `0` 将删除所有恢复状态。完全清理后，下一次按 Ctrl+S 将写入新的主保存。

---

## 启动恢复

启动时，如果 Lumi 检测到最近打开的文件具有比上次完整保存更新的自动保存数据，它会在加载前显示恢复提示。您可以接受（加载自动保存）或关闭（正常打开主保存）。