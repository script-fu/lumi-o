---
title: "Слои и неразрушающее редактирование"
type: docs
---
Система слоев Lumi обеспечивает сложные, неразрушающие рабочие процессы с полным контролем над смешиванием, маскированием и композицией.

## Обзор

Слои — это основа структурированной иллюстрации. Каждый слой независим, имеет собственный режим наложения, непрозрачность и дополнительную маску слоя. Группы могут вкладывать слои иерархически со своими собственными свойствами смешивания и обрезки.

## Доступ

**Панели** → **Слои** или панель **Слои** по умолчанию справа.

## Типы слоев

### Слои краски
Стандартные растровые слои для нарисованного контента. Храните данные пикселей в виде буферов GEGL с дополнительной альфа-прозрачностью.

### Групповые слои
Иерархические контейнеры для организации связанных слоев. Группы могут иметь собственный режим наложения, непрозрачность и обтравочные маски. Групповые прогнозы составляются по требованию.

### Маски слоев
Маски оттенков серого, прикрепленные к любому слою, контролирующие непрозрачность каждого пикселя. Рисование на маске белым цветом делает пиксели непрозрачными; черный делает их прозрачными; серый обеспечивает частичную непрозрачность.

## Режимы наложения

У каждого слоя есть режим наложения, определяющий, как он сочетается со слоями ниже:

- **Нормальный**: прямое наложение непрозрачности.
- **Умножение**: затемнение путем умножения значений цвета.
- **Экран**: осветление путем инвертирования, умножения и повторного инвертирования.
- **Наложение**: сочетание функций «Умножение» и «Расширение».
- **Добавить**: аддитивное смешивание (суммирование значений цвета).
- **Вычитание**: субтрактивное смешивание.
- **Цвет, оттенок, насыщенность, яркость**: смешивание компонентов HSL.

## Обрезка и маскирование

- **Композитный режим — «Клип на фон»**: установка режима композиции слоя на **Клип на фон** ограничивает композицию областями, где накопленные слои **Объединения** ниже имеют установленную непрозрачность. Слой рисует только там, где у этих слоев есть контент — он не может расширить альфа-след. Это значение устанавливается для каждого слоя в диалоговом окне «Атрибуты слоя» (раскрывающийся список **Композитный режим**). Если эффективный режим композиции слоя отличается от режима «Объединение», значок глаза на панели «Слои» заменяется значком композиции, указывая на нестандартное поведение композиции.

  **Пример — общая альфа-форма.** В группе нижний слой содержит закрашенный круг на прозрачном фоне, для которого установлен составной режим **Объединение** по умолчанию. Для каждого слоя над ним в той же группе установлен режим **Обрезать по фону**. Эти слои могут рисовать только там, где круг обеспечивает непрозрачность — одна фигура, много слоев. Это обычный шаблон для раскрашивания, растушевки и детализации определенного силуэта, не беспокоясь о растекании.
- **Маски слоя**: примените маску в оттенках серого, чтобы попиксельно управлять видимостью слоев. Белая краска на маске раскрывает; черный скрывает; серый обеспечивает частичную непрозрачность.
- **Чисто дочерние маски**: маски хранятся как дочерние элементы в стеке рисования, что предотвращает потерю данных во время преобразований.

## Выбор слоя (клавиша Alt)

Нажатие **Alt** (левый Alt) при наведении курсора на холст позволяет выбрать слой с видимыми пикселями под курсором — без переключения инструментов или щелчка.

### Как это работает

- **Нажмите Alt**: курсор изменится на перекрестие, указывая на то, что режим выбора активен.
- **Отпустите Alt**: Люми выбирает самый верхний непрозрачный слой в позиции курсора (непрозрачность> 25%) и выделяет его. Слой выделяется на панели «Слои», а в строке состояния отображается ** «Выбранный слой: «имя слоя»»**.
— В центральной точке выбранного слоя на холсте рисуется маркер. Ручка уменьшается и исчезает по мере удаления курсора.

### Переключение слоевКаждое последующее нажатие Alt в том же месте выбирает **следующий слой** в стопке в этой точке. Люми запоминает последний выбранный слой и переходит от него к нижнему. Как только достигается нижняя часть стека, следующее нажатие возвращается к самому верхнему слою в этой позиции. Это упрощает доступ к вложенным слоям в сложных сценах, многократно нажимая Alt.

### Правила отмены

Выбор отменяется (не срабатывает при отпускании Alt), если при удерживании Alt происходит одно из следующих событий:

- Нажата кнопка мыши (щелкните левой или правой кнопкой мыши).
- Нажата любая другая клавиша.

Это гарантирует, что жесты перетаскивания Alt (например, регулировка размера кисти) и измененные с помощью Alt сочетания клавиш работают без случайного изменения активного слоя.

### Ограничения

— Выбор слоя не активируется во время операций с инструментом **Трансформирование** — Alt здесь имеет другое значение.
- Выбор не происходит, если присутствует плавающий выбор.
- Только левый Alt запускает выбор; правый Alt рассматривается как стандартный модификатор.

## Операции

На панели «Слои»:

- **Создать слой**: щелкните правой кнопкой мыши → **Новый слой** или воспользуйтесь меню **Слой**.
- **Дублировать**: щелкните правой кнопкой мыши → **Дублировать** или **Слой** → **Дублировать**.
- **Удалить**: щелкните правой кнопкой мыши → **Удалить** или выберите и нажмите **Удалить**.
- **Изменить порядок**: перетащите слои вверх или вниз, чтобы изменить порядок расположения.
- **Переименовать**: дважды щелкните имя слоя.
- **Объединить вниз**: щелкните правой кнопкой мыши → **Объединить вниз**, чтобы объединить со слоем ниже.
- **Свести изображение**: **Изображение** → **Свести изображение**, чтобы объединить все видимые слои.

## Свойства слоя

- **Непрозрачность**: 0–100 %, контролирует общую прозрачность слоя.
- **Режим наложения**: раскрывающееся меню для выбора способа объединения слоя со слоями ниже.
- **Видимый/Скрытый**: значок глаза переключает видимость слоя.

## Блокировки слоев

Значки блокировки отображаются в строке заголовка панели «Слои». Каждый замок можно включать независимо. Щелчок правой кнопкой мыши по значку замка устанавливает его исключительно (блокирует только этот тип, разблокируя все остальные на том же слое).

- **Блокировать альфа**: предотвращает закрашивание прозрачных областей. Мазки кисти влияют только на пиксели, которые уже имеют непрозрачность; полностью прозрачные пиксели не изменяются. Полезно для рисования внутри существующих фигур, не выходя за их пределы.

- **Блокировать маску**: предотвращает редактирование маски слоя. Маска остается видимой и активной, но ее нельзя рисовать или изменять, пока эта блокировка включена.

- **Цвет блокировки**: фиксирует рисование на определенном цвете — текущем цвете переднего плана на момент применения блокировки. Последующие штрихи на этом слое используют сохраненный цвет независимо от активного цвета переднего плана. Разблокировка удаляет сохраненный цвет.

- **Блокировать содержимое** (Блокировать пиксели): предотвращает редактирование всех пикселей слоя. Слой нельзя закрашивать, заливать, трансформировать или иным образом изменять. Полезно для защиты готовых слоев.

- **Зафиксировать положение**: предотвращает перемещение или преобразование слоя. Слой по-прежнему можно редактировать; блокируются только позиционные изменения (инструмент «Перемещение», инструмент «Трансформирование»).

- **Заблокировать видимость**: предотвращает переключение видимости слоя значком глаза. Защищает слои, которые всегда должны оставаться видимыми (или скрытыми) во время редактирования.

Все блокировки сохраняются вместе с проектом и сохраняются между сеансами.

## Эффекты слоя (эффекты)

Неразрушающие фильтры GEGL, применяемые через меню **Фильтры**, сохраняются как зафиксированные эффекты на слое, а не немедленно изменяют пиксели. Если у слоя есть хотя бы один зафиксированный эффект, на панели «Слои» рядом с этим слоем появляется значок **fx**.### Доступ к всплывающему окну эффектов

Нажмите значок **fx** в строке слоя на панели «Слои», чтобы открыть всплывающее окно **Эффекты слоя** для этого слоя.

Во всплывающем окне отображается стек фильтров для слоя — каждый зафиксированный эффект указан по имени с переключателем видимости рядом с ним.

### Элементы управления

- **Переключение видимости глаз** (верхняя часть всплывающего окна): одновременное включение и выключение всех эффектов.
- **Переключение видимости для каждого фильтра**: каждая строка фильтра имеет собственный значок глаза, позволяющий независимо включать или отключать этот эффект.
- **Редактировать**: открывает диалоговое окно настроек выбранного фильтра, позволяющее корректировать его параметры неразрушающим образом.
- **Поднять/Опустить**: перемещает выбранный фильтр вверх или вниз в стеке, изменяя порядок применения эффектов.
- **Объединить**: фиксирует все видимые в данный момент эффекты в пикселях слоя, делая изменения постоянными. Значок эффекта удаляется, если все эффекты объединены. Объединение недоступно для составных слоев.
- **Удалить**: полное удаление выбранного фильтра. Поповер автоматически закроется, если не останется эффектов.

Двойной щелчок по фильтру в списке также открывает диалоговое окно его редактирования.

**Редактировать** и **Удалить** блокируются, если на слое активна функция «Блокировать пиксели». Фильтры нельзя изменить в порядке, пока один из них активно редактируется.

### Добавление эффектов

Примените фильтр из **Фильтры** → (любая категория). Если выбран активный слой и операция выполняется неразрушающим образом, результат сохраняется как эффект слоя, а не записывается в данные пикселей. Значок эффекта появляется на слое, если присутствует хотя бы один эффект.

## Диалоговое окно атрибутов слоя

Дважды щелкните слой на панели «Слои», чтобы открыть диалоговое окно «Атрибуты слоя».

### Личность

- **Цветная метка**: цветовая метка для визуальной организации на панели «Слои».

### Объединение пространства и режима

- **Композитное пространство**: цветовое пространство, используемое при компоновке этого слоя со слоями ниже. Варианты: Авто, Линейный (RGB), Перцепционный (RGB).
- **Композитный режим**: управляет взаимодействием альфа-слоя с фоном. Варианты включают «Объединение» (влияет на все области — значение по умолчанию для обычного режима), «Обрезать до фона» (влияет только на области с существующим содержимым — значение по умолчанию для большинства других режимов наложения) и «Пересечение».

### Размер и смещения

Для существующего слоя в поле **Размеры** отображаются размеры слоя и размеры маски (если маска прикреплена) в виде меток, доступных только для чтения.

**Смещение слоя** — счетчики X и Y, управляющие положением слоя на холсте. Изменения применяются немедленно, а не при закрытии диалогового окна.

Если слой имеет маску, ниже отображаются **Смещения маски** — счетчики X и Y для независимого положения маски.

При создании нового слоя поля «Ширина» и «Высота», а также раскрывающийся список **Заполнить** («Передний план», «Фон», «Белый», «Прозрачный») заменяют отображение размера, доступного только для чтения.

### Атрибуты слоя (постоянные паразиты)

Нижняя часть диалогового окна содержит прокручиваемую таблицу «Имя/значение» для постоянных паразитов — произвольные метаданные «ключ-значение», прикрепленные к слою. Эти значения хранятся вместе с проектом и доступны из интерфейса сценариев Scheme.

- Щелкните любую ячейку в столбце «Имя» или «Значение», чтобы отредактировать ее в строке.
- **Добавить**: добавляет новую пустую строку.
- **Удалить**: удаляет выбранную строку и ее паразит из слоя.

Если в слое нет постоянных паразитов, отображаются три пустые стартовые строки.

### Состояние контентаИнформационная строка, доступная только для чтения, внизу показывает текущее состояние содержимого слоя (и маску, если она есть): **Четкий**, **Равномерный** или **Смешанный**. Префикс `*` указывает на то, что в слое имеются несохраненные изменения с момента последнего сохранения.

## Производительность

- **Быстрый режим**: при рисовании на одном слое, вложенном в группу, Lumi временно переключает группы-предки на сквозной рендеринг на время мазка, пропуская полную рекомпозицию групповой проекции. Это устраняет задержку обновления вложенной проекции во время рисования и рисования. Полная композиция возобновляется после завершения обводки, изменения активного слоя или перед сохранением.

  Быстрый режим отключается, если к родительской группе применимо любое из следующих условий:
  - В группе есть видимые неразрушающие фильтры (для фильтров нужен буфер проекции).
  - Режим наложения группы может быть любым, кроме **Нормального** или **Проходного**.
  - У группы есть прямой дочерний элемент, использующий составной режим **Обрезка к фону** или **Пересечение** (для этого требуются данные фона из буфера проекции).

  Быстрый режим также не активируется для слоев верхнего уровня, плавающих выделений или при одновременном выборе нескольких слоев.

  Структурирование файлов во избежание этих условий в группах рисования с использованием нормальных режимов наложения слоев гарантирует, что быстрый режим останется активным на протяжении всего сеанса рисования или рисования.
- **Отложенная загрузка**: большие проекты загружаются быстро; данные слоя загружаются только при необходимости (например, когда они становятся видимыми или закрашиваются).

## Формат файла

Все слои, маски и свойства хранятся в открытом формате Lumi `.lum`. Файл представляет собой каталог, содержащий отдельные буферы слоев и метаданные, что обеспечивает совместимость и долгосрочную доступность.