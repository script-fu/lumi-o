---
title: "图层和无损编辑"
type: docs
---
Lumi 的图层系统可实现复杂、非破坏性的工作流程，并完全控制混合、遮罩和合成。

## 概述

图层是结构化插图的基础。每个图层都是独立的，具有自己的混合模式、不透明度和可选的图层蒙版。组可以使用自己的混合和剪切属性分层嵌套图层。

## 访问

**面板** → **图层**，或右侧默认的**图层**面板。

## 图层类型

### 油漆层
用于绘制内容的标准栅格图层。将像素数据存储为具有可选 Alpha 透明度的 GEGL 缓冲区。

### 图层组
用于组织相关层的分层容器。组可以有自己的混合模式、不透明度和剪切蒙版。团体预测是按需合成的。

### 图层蒙版
灰度蒙版附加到任何层，控制每个像素的不透明度。用白色在蒙版上绘画会使像素不透明；黑色使它们透明；灰色提供部分不透明度。

## 混合模式

每个图层都有一个混合模式，决定它如何与下面的图层组合：

- **正常**：直接不透明混合。
- **乘法**：通过乘以颜色值来变暗。
- **屏幕**：通过反转、相乘、再次反转来变亮。
- **叠加**：乘法和屏幕的组合。
- **添加**：加法混合（对颜色值求和）。
- **减法**：减法混合。
- **颜色、色调、饱和度、亮度**：HSL 组件混合。

## 剪切和遮罩

- **合成模式 - 剪辑到背景**：将图层的合成模式设置为 **剪辑到背景** 可将合成限制到下面累积的 **联合** 图层已建立不透明度的区域。该图层仅在这些图层有内容的地方绘制 - 它无法扩展 alpha 足迹。这是在“图层属性”对话框（**复合模式**下拉列表）中按图层设置的。当图层的有效合成模式不是“联合”时，“图层”面板中的眼睛图标将替换为合成图标，以指示非标准合成行为。

  **示例 — 共享 alpha 形状：** 在组中，底层包含透明背景上的实心圆，设置为默认的 **Union** 复合模式。同一组中其上方的每个图层都设置为 **剪辑到背景**。这些图层只能在圆圈提供不透明度的地方进行绘制——一个形状，多个图层。这是一种常见的模式，用于在定义的轮廓内进行着色、阴影和细节处理，而无需担心溢出。
- **图层蒙版**：应用灰度蒙版来逐像素控制图层可见性。在面具上涂上白色，露出来；黑色隐藏；灰色提供部分不透明度。
- **纯子掩码**：掩码作为子项存储在可绘制堆栈中，防止转换期间数据丢失。

## 图层选取（Alt 键）

将鼠标悬停在画布上时点击 **Alt**（左 Alt）即可选择光标下方具有可见像素的图层 - 无需切换工具或单击。

### 它是如何运作的

- **按 Alt**：光标变为十字线，表示拾取模式已激活。
- **释放 Alt**：Lumi 在光标位置拾取最上面的非透明图层（不透明度 > 25%）并选择它。该图层在“图层”面板中突出显示，并且状态栏显示**“选取的图层：‘图层名称’”**。
- 在画布上所选图层的中心点绘制一个手柄。当光标移开时，手柄会减小并消失。

### 层层循环随后在同一位置每次点击 Alt 都会选择该点堆栈中的**下一层**。 Lumi 会记住最后选择的图层并跳到下面的图层。一旦到达堆栈的底部，下一个点击循环回到该位置的最顶层。这使得通过反复点击 Alt 可以轻松到达复杂场景中的嵌套图层。

### 取消规则

如果按住 Alt 时发生以下任一情况，则拾取将被取消（松开 Alt 时不会触发）：

- 按下鼠标按钮（左键或右键单击）。
- 按下任何其他键。

这可确保 Alt 拖动手势（例如画笔大小调整）和 Alt 修改的快捷方式正常工作，而不会意外更改活动图层。

### 限制

- 在**变换**工具操作期间不会激活图层拾取 - Alt 在那里有不同的含义。
- 如果存在浮动选择，则不会进行拾取。
- 仅左Alt触发拾取；右 Alt 被视为标准修饰符。

## 操作

在图层面板中：

- **创建图层**：右键单击→ **新建图层**，或使用**图层**菜单。
- **复制**：右键单击→ **复制**，或**图层** → **复制**。
- **删除**：右键单击→ **删除**，或选择并按**删除**。
- **重新排序**：向上或向下拖动图层以更改堆叠顺序。
- **重命名**：双击图层名称。
- **向下合并**：右键→ **向下合并**与下面的图层合并。
- **拼合图像**：**图像** → **拼合图像**合并所有可见图层。

## 图层属性

- **不透明度**：0–100%，控制整体图层透明度。
- **混合模式**：下拉菜单用于选择图层与下面图层的组合方式。
- **可见/隐藏**：眼睛图标切换图层可见性。

## 图层锁

锁定图标显示在“图层”面板标题行中。每个锁都可以独立切换。右键单击锁定图标可将其设置为独占（仅锁定该类型，解锁同一图层上的所有其他类型）。

- **锁定 Alpha**：防止在透明区域上绘画。画笔描边仅影响已经具有不透明度的像素；完全透明的像素不会被修改。对于在现有形状内绘画而不溢出到外部非常有用。

- **锁定蒙版**：防止编辑图层蒙版。在此锁打开时，蒙版保持可见且处于活动状态，但无法进行绘制或修改。

- **锁定颜色**：将绘画锁定为特定颜色 - 应用锁定时的当前前景色。无论活动前景色如何，该图层上的后续笔划都使用该存储的颜色。解锁会丢弃存储的颜色。

- **锁定内容**（锁定像素）：防止对图层进行所有像素编辑。不能对该图层进行绘制、填充、转换或以其他方式修改。可用于保护成品层。

- **锁定位置**：防止图层被移动或变换。该图层仍然可以编辑；仅阻止位置更改（移动工具、变换工具）。

- **锁定可见性**：防止眼睛图标切换图层的可见性。保护在编辑期间应始终保持可见（或隐藏）的图层。

所有锁都与项目一起保存并在会话中持续存在。

## 图层效果 (fx)

通过**滤镜**菜单应用的非破坏性 GEGL 滤镜将作为图层上的提交效果存储，而不是立即修改像素。当某个图层至少有一个已提交的效果时，该图层旁边的“图层”面板中会出现一个 **fx** 图标。### 访问效果弹出窗口

单击“图层”面板中图层行上的 **fx** 图标，打开该图层的 **图层效果** 弹出窗口。

弹出窗口显示该层的过滤器堆栈 - 每个提交的效果按名称列出，旁边有一个可见性切换。

### 控制

- **可见性眼睛切换**（弹出窗口顶部）：同时打开或关闭所有效果。
- **每个过滤器可见性切换**：每个过滤器行都有自己的眼睛图标，可以独立启用或禁用该效果。
- **编辑**：打开所选过滤器的设置对话框，允许无损地调整其参数。
- **升高/降低**：在堆栈中向上或向下移动选定的滤镜，更改应用效果的顺序。
- **合并**：将所有当前可见的效果提交到图层的像素，使更改永久化。如果合并所有效果，则 fx 图标将被删除。合并在图层组上不可用。
- **删除**：完全删除选定的过滤器。如果没有效果，弹出窗口将自动关闭。

双击列表中的过滤器也会打开其编辑对话框。

如果锁定像素在图层上处于活动状态，则 **编辑** 和 **删除** 将被阻止。正在编辑过滤器时，无法对过滤器重新排序。

### 添加效果

从 **过滤器** → （任何类别）应用过滤器。如果以活动图层为目标并且操作非破坏性地运行，则结果将存储为图层效果，而不是烘焙到像素数据中。当至少存在一种效果时，fx 图标会出现在图层上。

## 图层属性对话框

双击“图层”面板中的图层以打开“图层属性”对话框。

### 身份

- **颜色标签**：“图层”面板中视觉组织的颜色标签。

### 复合空间和模式

- **复合空间**：将此图层与下面的图层合成时使用的颜色空间。选项：自动、线性 (RGB)、感知 (RGB)。
- **复合模式**：控制图层 Alpha 与背景的交互方式。选项包括“并集”（影响所有区域 - 普通模式的默认值）、剪辑到背景（仅影响具有现有内容的区域 - 大多数其他混合模式的默认值）和“交集”。

### 大小和偏移

对于现有图层，**尺寸**将图层尺寸和蒙版尺寸（如果附加了蒙版）显示为只读标签。

**图层偏移** — X 和 Y 微调器控制图层在画布上的位置。更改会立即应用，而不是在对话框关闭时应用。

如果图层有遮罩，**遮罩偏移** — 用于遮罩独立位置的 X 和 Y 微调器 — 如下所示。

创建新图层时，宽度和高度字段以及**填充**下拉列表（前景、背景、白色、透明）将替换只读尺寸显示。

### 图层属性（持久性寄生虫）

对话框的下半部分包含持久性寄生虫的可滚动名称/值表 - 附加到层的任意键值元数据。这些值与项目一起存储，并且可以从Scheme 脚本界面访问。

- 单击“名称”或“值”列中的任意单元格以进行内联编辑。
- **添加**：追加一个新的空行。
- **删除**：从图层中删除选定的行及其寄生虫。

如果该层没有持久性寄生虫，则会显示三个空起始行。

### 内容状态底部的只读信息行显示图层的当前内容状态（以及蒙版，如果存在）：**清除**、**统一**或**混合**。 `*` 前缀表示该图层自上次保存以来有未保存的更改。

## 性能

- **快速模式**：在嵌套在组内的单个图层上进行绘画时，Lumi 会在笔画持续时间内临时将祖先组切换为直通渲染，从而跳过完整的组投影重组。这消除了墨迹书写和绘画期间的嵌套投影更新滞后。当笔画结束、活动图层更改或保存之前，完整合成将恢复。

  当以下任何条件适用于祖先组时，快速模式将被禁用：
  - 该组具有可见的非破坏性滤镜（滤镜需要投影缓冲区）。
  - 该组的混合模式不是 **正常** 或 **直通**。
  - 该组有一个直接子级，使用 **Clip to Backdrop** 或 **Intersection** 复合模式（这些需要来自投影缓冲区的背景数据）。

  对于顶级图层、浮动选区或同时定位多个图层时，也不会激活快速模式。

  构建文件以避免绘画组中的这些情况，在图层上使用正常混合模式，可确保快速模式在整个墨迹书写或绘画会话中保持活动状态。
- **延迟加载**：大型项目加载速度快；图层数据仅在需要时加载（例如，当可见或绘制时）。

## 文件格式

所有图层、蒙版和属性均以 Lumi 的开放 `.lum` 格式存储。该文件是一个包含各个层缓冲区和元数据的目录，确保兼容性和长期可访问性。