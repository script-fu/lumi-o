---
title: "ファイル形式 (.lum)"
type: docs
---
Lumi は、パフォーマンス、信頼性、長期的なアクセス性を考慮して設計された、オープンなディレクトリベースのファイル形式 (`.lum`) を使用します。

## 概要

`.lum` ファイルは、実際には以下を含むディレクトリです。
- **メタデータ** (レイヤー、ブレンド モード、プロパティ)。
- **レイヤー バッファー** (各レイヤーの個別のピクセル データ)。
- **マスク** (レイヤーマスクのグレースケールデータ)。
- **回復履歴** (増分スナップショット)。

この構造により、高速な保存、大きなファイルの遅延ロード、およびクラッシュ後でも作業の回復が可能になります。

## 主要なプロパティ

### オープンで読みやすい

`.lum` 形式は、XML メタデータと圧縮バイナリ バッファを使用します。レイヤー構造、プロパティ、ブレンド モードをプレーン テキストで検査できます。独自のコーデックはありません。ピクセル データは標準の GEGL バッファ形式で保存されます。

### 増分保存

増分保存は、**名前を付けて保存ダイアログ** (**増分保存** チェックボックスと **最大保存数** スピン ボタン) でプロジェクトごとに有効にする必要があります。有効にすると、Ctrl+S でプロジェクト全体を書き直すのではなく、変更されたレイヤーのみが書き込まれるため、保存時間が大幅に短縮されます。設定はプロジェクトとともに保存され、セッションをまたいで保持されます。

### 遅延読み込み

大規模プロジェクトは迅速にオープンします。レイヤーピクセルは、次の場合にのみディスクからロードされます。
- レイヤーが表示されます。
- レイヤー上にペイントします。
- レイヤーはエクスポートまたは合成されます。

非常に大規模なプロジェクト (500 以上のレイヤー、数ギガバイトのデータ) は応答性を維持します。遅延読み込みはデフォルトで有効になっており、**編集 → 環境設定 → パフォーマンス → メモリ リソース** で切り替えることができます。

### 自動保存

Lumi は、**別のキャッシュの場所** (`~/.cache/lumi/autosave/`) に変更を定期的に自動的に保存します。自動保存は作業ファイルから独立しており、作業ファイルを変更しません。間隔とキャッシュの場所は、**編集 → 環境設定 → パフォーマンス** で構成できます。

## アクセス

### 保存して名前を付けて保存

- **ファイル** → **保存** (Ctrl+S): 現在の `.lum` ディレクトリに保存します。
- **ファイル** → **名前を付けて保存** (Shift+Ctrl+S): 新しい `.lum` ファイルに保存します。 [名前を付けて保存] ダイアログには、圧縮タイプのオプションと、このプロジェクトの増分保存を有効または無効にするための **増分保存** トグル (**最大保存数** 制限あり) が含まれています。

保存されていない変更は、ウィンドウ タイトルにアスタリスク (*) で示されます。

### エクスポート

- **ファイル** → **名前を付けてエクスポート** (Shift+Ctrl+E): PNG、JPEG、TIFF、またはその他の形式にエクスポートします。
- **ファイル** → **上書き** (Ctrl+E): 最後にエクスポートしたファイルに再エクスポートします。

エクスポートすると、表示レイヤーが平坦化され、スペクトルから sRGB カラー スペースに変換されます。

### インポート

- **ファイル** → **開く** (Ctrl+O): `.lum` プロジェクトをロードします。
- **ファイル** → **レイヤーとして開く** (Shift+Ctrl+O): `.lum`、XCF、または PSD ファイルを新しいレイヤーとしてインポートします。
- **ファイル** → **最近のファイル**: 最近開いたプロジェクトに素早くアクセスします。

PSD および XCF ファイルはインポート時に Lumi のネイティブ形式に変換されます。

## インポートとエクスポートの互換性

### サポートされているインポート形式
- **.lum**: Lumi ネイティブ形式。
- **.xcf**: GIMP ネイティブ形式 (レイヤーと基本プロパティは保持されます)。
- **.psd**: Photoshop 形式 (レイヤーとブレンド モードは保持されます)。
- **PNG、JPEG、TIFF など**: フラット化された画像のインポート。

### サポートされているエクスポート形式
- **PNG**: ロスレス、アルファ透明。
- **JPEG**: 非可逆、平坦化されています。
- **TIFF**: ロスレスまたは LZW 圧縮。
- **XCF**: GIMP 互換形式。輸出専用。レイヤーと基本プロパティは保持されます。

## プロジェクトのリカバリLumi は自動バックグラウンド保存と手動増分チェックポイントを維持しており、どちらも **ファイル** → **イメージの回復** からアクセスできます。詳細については、[File Recovery](../recovery) ページを参照してください。

## 組織

`.lum` ファイルは、固定構造のディレクトリです。

```
my-painting.lum/
  ├── metadata.xml                       (image structure, layer tree, properties)
  ├── thumbnail-YYYYMMDD-HHMMSS.png      (last-saved thumbnail)
  ├── drawables/
  │   ├── layer-<name>.geglbuf           (pixel data per layer)
  │   └── mask-<name>.geglbuf            (mask data, shares layer name)
  ├── icc/                               (embedded colour profiles)
  ├── parasites/                         (per-image metadata)
  ├── paths/                             (vector paths as SVG)
  ├── configs/                           (non-destructive filter configurations)
  └── recovery/
      └── primary-01.lum/                (incremental save checkpoint)
          ├── metadata.xml
          ├── drawables/                 (only modified buffers)
          ├── delta-0001.lum/            (Ctrl+S checkpoint)
          └── delta-0002.lum/
```

レイヤ バッファには、レイヤにちなんで名前が付けられます (`layer-Background.geglbuf`)。連番ではありません。レイヤー名のスペースはアンダースコアとして保存されます。グループ レイヤーには `-GROUP` サフィックスが付けられます。マスクはレイヤー名 (`mask-Background.geglbuf`) を共有します。

各 `recovery/primary-NN.lum/` は完全なベースライン保存です。続けて Ctrl+S を押すと、最後のベースライン以降に変更されたバッファのみを含む `delta-NNNN.lum/` サブディレクトリが追加され、プロジェクト サイズに関係なくチェックポイントの高速保存が維持されます。

自動保存は同じ構造に従いますが、`~/.cache/lumi/autosave/` に個別に保存され、作業ファイルは変更されません。
- **非常に大規模なプロジェクト**: 1000 以上のレイヤーとテラバイト単位のデータを含むプロジェクトは、遅延読み込みによって最もメリットが得られます。ただし、フラット イメージ形式への最終エクスポートには時間がかかる場合があります。
- **ネットワーク ドライブ**: ネットワークにマウントされたディレクトリへの保存はサポートされていますが、I/O 遅延のためローカル ストレージよりも遅くなります。