---
title: "ファイルの回復"
type: docs
---
Lumi は、自動バックグラウンド保存と手動増分チェックポイントという 2 つの独立した回復システムを維持しており、両方とも 1 つのダイアログからアクセスできます。

## アクセス

**ファイル** → **イメージを回復**

ダイアログが開き、現在開いているファイルのリカバリ状態があらかじめ設定されています。上部のファイル選択を使用して、別の `.lum` ファイルに切り替えます。

---

## 自動保存

Lumi は、編集中に定期的に作業のバックグラウンド スナップショットを保存します。自動保存は **別のキャッシュ ディレクトリ**に書き込まれ、作業中の `.lum` ファイルはそのまま残ります。

```
~/.cache/lumi/autosave/~home~user~projects~my-painting.lum/
```

パスのエンコードでは、`~` を区切り文字として使用して、ファイルごとに一意のキャッシュ ディレクトリを作成します。これは、プロジェクト ファイル自体が失われたり破損したりした場合でも、自動保存が利用できることを意味します。

- **頻度**: **編集** → **環境設定** → **パフォーマンス** → 自動保存間隔で構成可能です。
- **保存場所**: 「環境設定」→「パフォーマンス」でも設定します。
- **目的**: クラッシュの回復。 [イメージの回復] ダイアログの [自動保存] タブには、利用可能な自動保存の状態がタイムスタンプとともに表示されます。

新しい自動保存データを含むファイルを開くと、Lumi は開く時間に通知します。

---

## 増分保存

増分保存は、**プロジェクト ファイル内**の `recovery/` に保存される手動チェックポイント システムです。構造は次のとおりです。

```
my-painting.lum/recovery/
  └── primary-01.lum/       (full baseline, created on first Ctrl+S)
      ├── delta-0001.lum/   (Ctrl+S checkpoint, only modified buffers)
      ├── delta-0002.lum/
      └── ...
```

新しい `primary-NN.lum/` ベースラインは、**ファイル → 保存** の後に書き込まれます。続けて Ctrl+S を押すと、最後のベースライン以降に変更されたバッファのみを含む `delta-NNNN.lum/` サブディレクトリが作成されます。自動保存デルタと手動保存デルタは別々のカウンタを使用するため、相互の履歴に干渉しません。

増分保存は **デフォルトでは無効になっています**。プロジェクトごとに有効にする必要があります。

1. **ファイル** → **名前を付けて保存** (Shift+Ctrl+S)。
2. [名前を付けて保存] ダイアログで、**増分保存** をオンにし、必要に応じて **最大保存数** 制限を設定します。
3. 設定はプロジェクトとともに保存され、それ以降のすべての Ctrl+S キーに適用されます。

プライマリ セーブよりも新しい増分セーブが含まれる `.lum` ファイルを開くと、Lumi は最新のチェックポイントをロードするよう促す **増分セーブが検出されました** プロンプトを表示します。

---

## 「イメージを復元」ダイアログ

ダイアログには 3 つのタブと 2 つのアクション ボタンがあります。

### 自動保存タブ

選択したファイルで利用可能なすべての自動保存状態を、タイムスタンプとサムネイル (利用可能な場合) とともにリストします。状態を選択し、[**回復**] をクリックして開きます。

このタブを使用して次のことを行います。
- クラッシュ後に回復します。
- 同じセッションから以前の状態に戻します。

### インクリメンタルタブ

プロジェクト ファイル内に保存されているすべてのチェックポイント状態をリストします。各エントリにはチェックポイントのタイムスタンプが表示されます。チェックポイントを選択し、[**回復**] をクリックして開きます。

このタブを使用して次のことを行います。
- 個別のファイルを保存せずに、セッション内の以前の時点に戻ります。
- プロジェクトのバージョン履歴を参照します。

### 最新のタブ

ダイアログが開いたときのデフォルトのタブ。自動保存と増分チェックポイントの両方で利用可能な最新のリカバリ状態を自動的に識別し、そのタイムスタンプを表示します。 [**回復**] をクリックすると、個々の状態を参照せずにすぐにロードされます。

---

## ボタン

|ボタン |アクション |
|----------|----------|
| **回復** |選択した回復状態を新しいイメージとして開きます。 |
| **閉じる** |回復せずにダイアログを閉じます。 |
| **古い州をクリーンアップ…** |クリーンアップ プロンプトを開きます (以下を参照)。 |

---

## 古い州を一掃する時間の経過とともに回復状態が蓄積されると、大量のディスク領域が消費される可能性があります。 **古い状態をクリーンアップ…** ボタン (ダイアログの左下) をクリックすると、アクティブなタブ (自動保存または増分) のクリーンアップ プロンプトが開きます。

プロンプトには次が表示されます。
- ファイルに存在する完全な保存の数。
- それらが占有する合計ディスク容量。
- **最新の状態を保持** スピン ボタンで、保持する保存の数を選択します。

**[最新の状態を保つ**] を `0` に設定すると、すべての回復状態が削除されます。完全クリーンアップ後の次の Ctrl+S により、新しいプライマリ セーブが書き込まれます。

---

## 起動時の回復

起動時に、最後に開いたファイルに最後の完全保存よりも新しい自動保存データがあることを Lumi が検出すると、ロードする前に回復プロンプトが表示されます。受け入れる (自動保存をロードする) ことも、拒否する (通常どおり主保存を開く) こともできます。